#
# Need to use -fno-strict-aliasing when compiling cython code, in order
# to avoid nasty compiler warnings about aliasing.  Cython explicitly
# performs aliasing, in order to emulate python object inheritance.
# See, for example,
# https://groups.google.com/forum/#!topic/cython-users/JV1-KvIUeIg
#
SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fno-strict-aliasing")
INCLUDE_DIRECTORIES(
	${Python3_INCLUDE_DIRS}
	${CMAKE_CURRENT_SOURCE_DIR}
	${CMAKE_CURRENT_BINARY_DIR}
)

# The -3 flag means "build for python3"
SET(CYTHON_FLAGS "-3" "-f" "-Wextra")

# The python module name is taken from the pyx filename. Thus, the file
# sensory.pyx means that module name will be 'opencog.sensory'. This will
# have an autogenerated PyInit_sensory() in it, again, based on the module
# name.
CYTHON_ADD_MODULE_PYX(sensory
	"sensory.pxd"
	"../sensory/types/sensory_types.pyx"
	"../sensory/types/atom_types.h")

ADD_LIBRARY(sensory_cython SHARED
	sensory.cpp
)

ADD_DEPENDENCIES(sensory_cython sensory_atom_types)

# The NO_AS_NEEDED forces the shared library ctors to run
# for the libsensory-whatever.so. These are needed to get
# the assorted atom type factories to get installed into
# the atompace nameserver.
TARGET_LINK_LIBRARIES(sensory_cython
	${NO_AS_NEEDED}
	sensory-types
	sensory-irc
	sensory-filedir
	sensory-terminal
	sensory
	atomspace
	${Python3_LIBRARIES}
)

SET_TARGET_PROPERTIES(sensory_cython PROPERTIES
	PREFIX ""
	OUTPUT_NAME sensory)

### install the modules ###
INSTALL(TARGETS
	sensory_cython
	DESTINATION "${PYTHON_DEST}")
